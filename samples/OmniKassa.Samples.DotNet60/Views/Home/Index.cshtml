@{
    ViewData["Title"] = "Home Page";
}

<h3>OmniKassa 2.0 Payment SDK Example (MVC @ViewBag.Runtime @ViewBag.RuntimeVersion)</h3>
<a href="/">Reset</a><br />
<br />
@if (Model != null)
{
    @if (Model.Error != null)
    {
        <div style="color:red"><b>@Model.Error</b></div>
    }
}
<br />
@if (Model != null)
{
    @if (Model.PaymentCompleted != null)
    {
        <h4>Payment callback</h4>
        <b>Order ID: @Model.PaymentCompleted.OrderId</b>
        <br />
        <b>Order status: @Model.PaymentCompleted.Status</b>
        <br />
        <br />
    }
}

@{Html.RenderPartial("OrderItems");}
@{Html.RenderPartial("OrderDetails");}
<br />

<form method="get" action="/Home/InitiateRefund" name="initiate_refund">
    <input type="submit" value="Initiate refund" id="initiate_refund_request">
</form>
<br />

<table>
    <tr>
        <td style="padding-right: 16pt;"><b>Merchant ID</b></td>
        <td style="padding-right: 16pt;"><b>Order ID</b></td>
        <td style="padding-right: 16pt;"><b>Order status</b></td>
        <td style="padding-right: 16pt;"><b>Paid amound</b></td>
        <td style="padding-right: 16pt;"><b>Total amount</b></td>
    </tr>
    @if (Model != null)
    {
        foreach (var response in Model.Responses)
        {
            foreach (var item in response.OrderResults)
            {
                <tr>
                    <td style="padding-right: 16pt;">@item.MerchantOrderId</td>
                    <td style="padding-right: 16pt;">@item.OmnikassaOrderId</td>
                    <td style="padding-right: 16pt;">@item.OrderStatus</td>
                    <td style="padding-right: 16pt;">@item.PaidAmount.Amount</td>
                    <td style="padding-right: 16pt;">@item.TotalAmount.Amount</td>
                </tr>
            }
        }
    }
</table>
<br />
<form method="post" action="/Home/RetrieveUpdates" name="order">
    <input type="submit" value="Retrieve updates" id="retrieve_updates">
</form>
<br />

<table>
    <tr>
        <td style="padding-right: 16pt;"><b>Name</b></td>
        <td style="padding-right: 16pt;"><b>Active</b></td>
    </tr>
    @if (Model != null && Model.PaymentBrandsResponse != null)
    {
        foreach (var brand in Model.PaymentBrandsResponse.PaymentBrands)
        {
            <tr>
                <td style="padding-right: 16pt;">@brand.Name</td>
                <td style="padding-right: 16pt;">@brand.IsActive</td>
            </tr>
        }
    }

</table>

<form method="post" action="/Home/RetrievePaymentBrands" name="payment_brands">
    <input type="submit" value="Retrieve payment brands" id="retrieve_payment_brands">
</form>
<br />

<table>
    <tr>
        <td style="padding-right: 16pt;"><b>Id</b></td>
        <td style="padding-right: 16pt;"><b>Name</b></td>
        <td style="padding-right: 16pt;"><b>Logo</b></td>
        <td style="padding-right: 16pt;"><b>Mime-type</b></td>
        <td style="padding-right: 16pt;"><b>Country names</b></td>
    </tr>
    @if (Model != null)
    {
        foreach (var issuer in Model.GetIdealIssuers())
        {
            <tr>
                <td style="padding-right: 16pt;">@issuer.Id</td>
                <td style="padding-right: 16pt;">@issuer.Name</td>
                <td style="padding-right: 16pt;"><img src=@issuer.Logos[0].Url alt=@issuer.Name width="50" height="50" /></td>
                <td style="padding-right: 16pt;">@issuer.Logos[0].MimeType</td>
                <td style="padding-right: 16pt;">@issuer.CountryNames</td>
            </tr>
        }
    }
</table>

<form method="post" action="/Home/RetrieveIdealIssuers" name="ideal_issuers">
    <input type="submit" value="Retrieve iDEAL issuers" id="retrieve_ideal_issuers">
</form>
<br />

<table>
    <tr>
        <td style="padding-right: 16pt;"><b>Shopper Reference</b></td>
        <td style="padding-right: 16pt;"><b>Id</b></td>
        <td style="padding-right: 16pt;"><b>Brand</b></td>
        <td style="padding-right: 16pt;"><b>Card No.</b></td>
        <td style="padding-right: 16pt;"><b>Card Exp.</b></td>
        <td style="padding-right: 16pt;"><b>Status</b></td>
        <td style="padding-right: 16pt;"><b>&nbsp;</b></td>
    </tr>
    @if (Model != null)
    {
        foreach (var cardOnFile in Model.GetCardsOnFile())
        {
            <form method="post" action="/Home/DeleteShopperPaymentDetail" name="delete_shopper_payment_details">
                <tr>
                    <td style="padding-right: 16pt;"><i>
                        <input type="text" name="shopperReference" id="shopper_reference" readonly value="@ViewBag.ShopperReference" />
                    </i></td>
                    <td style="padding-right: 16pt;"><i>
                        <input type="text" name="id" id="id" readonly value="@cardOnFile.Id" />
                    </i></td>
                    <td style="padding-right: 16pt;">@cardOnFile.Brand</td>
                    <td style="padding-right: 16pt;">@cardOnFile.Last4Digits</td>
                    <td style="padding-right: 16pt;">@cardOnFile.CardExpiry</td>
                    <td style="padding-right: 16pt;">@cardOnFile.Status</td>
                    <td style="padding-right: 16pt;">
                        <input type="submit" value="Delete" id="retrieve_ideal_issuers">
                    </td>
                </tr>
            </form>
        }
    }
</table>

<form method="post" action="/Home/RetrieveShopperPaymentDetails" name="shopper_payment_details">
    <table>
        <tr>
            <td>
                <label for="shopper_reference">Shopper reference</label>
                <input type="text" name="shopperReference" id="shopper_reference" value="@ViewBag.ShopperReference" />
            </td>
        </tr>
    </table>
    <input type="submit" value="Retrieve cards on file" id="retrieve_shopper_payment_details">
</form>

<br />
<br />
<br />
<br />
<br />
